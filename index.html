<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Reigns: Batalla Modular</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a202c;
        }
        .font-title {
            font-family: 'Lilita One', cursive;
        }
        .stat-bar-inner {
            transition: width 0.5s ease-in-out;
        }
        .game-container {
            max-width: 500px;
            width: 100%;
            height: 100vh;
            max-height: 900px;
            display: flex;
            flex-direction: column;
        }
        .choice-button {
            transition: background-color 0.2s, transform 0.2s;
            border-bottom-width: 4px;
            min-height: 70px; /* Asegura altura m√≠nima */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .choice-button:hover {
            transform: translateY(-2px);
        }
        .choice-button:active {
            transform: translateY(1px);
        }
        #super-button:disabled {
            filter: grayscale(80%);
            cursor: not-allowed;
        }
        #game-overlay, #resolution-overlay {
            transition: opacity 0.5s;
        }
        .hidden-overlay {
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-4">

    <div id="game-container" class="game-container bg-gray-800 rounded-3xl shadow-2xl p-4 sm:p-6 flex flex-col justify-between relative">
        
        <!-- Secci√≥n de Estad√≠sticas -->
        <div id="stats-container" class="space-y-3">
            <div class="flex justify-between items-center text-yellow-300 font-title">
                <span>ASALTO</span>
                <span id="assault-counter">1</span>
            </div>
            <!-- Vida -->
            <div class="stat">
                <div class="flex justify-between items-center mb-1"><span class="text-sm font-bold text-green-400">‚ù§Ô∏è VIDA</span><span id="health-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2.5"><div id="health-bar" class="bg-green-500 h-2.5 rounded-full stat-bar-inner"></div></div>
            </div>
            <!-- Ataque -->
            <div class="stat">
                <div class="flex justify-between items-center mb-1"><span class="text-sm font-bold text-orange-400">üí• ATAQUE</span><span id="attack-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2.5"><div id="attack-bar" class="bg-orange-500 h-2.5 rounded-full stat-bar-inner"></div></div>
            </div>
            <!-- Defensa -->
            <div class="stat">
                <div class="flex justify-between items-center mb-1"><span class="text-sm font-bold text-sky-400">üõ°Ô∏è DEFENSA</span><span id="defense-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2.5"><div id="defense-bar" class="bg-sky-500 h-2.5 rounded-full stat-bar-inner"></div></div>
            </div>
            <!-- Superpoder -->
            <div class="stat">
                <div class="flex justify-between items-center mb-1"><span class="text-sm font-bold text-yellow-400">üåü SUPERPODER</span><span id="super-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2.5"><div id="super-bar" class="bg-yellow-400 h-2.5 rounded-full stat-bar-inner"></div></div>
            </div>
        </div>

        <!-- Secci√≥n de Carta del Dilema -->
        <div class="flex-grow flex flex-col items-center justify-center my-4 relative">
            <div id="dilemma-card" class="bg-gray-700 rounded-2xl shadow-xl p-4 w-full max-w-sm text-center flex flex-col items-center justify-center flex-grow">
                <img id="char-img" src="" class="w-20 h-20 rounded-full object-cover mb-3 border-4 border-gray-600" alt="Personaje">
                <h2 id="char-name" class="font-title text-2xl text-yellow-300 mb-1"></h2>
                <p id="dilemma-description" class="text-gray-200"></p>
            </div>
        </div>
        
        <!-- Bot√≥n de Superpoder -->
        <div class="my-2">
            <button id="super-button" class="choice-button w-full bg-yellow-500 border-yellow-700 hover:bg-yellow-400 text-gray-900 font-bold py-3 px-4 rounded-xl text-lg font-title">
                USAR SUPERPODER
            </button>
        </div>

        <!-- Secci√≥n de Decisiones -->
        <div id="choices-section" class="grid grid-cols-2 gap-3">
            <button id="choice-1" class="choice-button bg-red-600 border-red-800 hover:bg-red-500 text-white font-bold py-3 px-4 rounded-xl text-sm"></button>
            <button id="choice-2" class="choice-button bg-blue-600 border-blue-800 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-xl text-sm"></button>
        </div>

        <!-- Overlay de Resoluci√≥n -->
        <div id="resolution-overlay" class="hidden-overlay absolute inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center text-center p-6 rounded-3xl z-30">
            <h1 id="resolution-title" class="font-title text-3xl mb-3 text-yellow-300"></h1>
            <p id="resolution-narrative" class="text-base mb-4"></p>
            <div id="resolution-effects" class="text-left space-y-1 mb-6"></div>
            <button id="resolution-continue" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full text-lg font-title">Continuar</button>
        </div>

        <!-- Overlay de Inicio/Fin -->
        <div id="game-overlay" class="absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center text-center p-6 rounded-3xl z-20">
            <h1 id="overlay-title" class="font-title text-5xl mb-4 text-yellow-300"></h1>
            <p id="overlay-text" class="text-lg mb-8"></p>
            <button id="overlay-button" class="bg-green-500 hover:bg-green-400 text-white font-bold py-3 px-8 rounded-full text-xl font-title"></button>
        </div>
    </div>

    <!-- =================================================================== -->
    <!-- === CONTENIDO (Simulando archivos .js separados) === -->
    <!-- =================================================================== -->
    
    <script>
        // Este array contendr√° los datos de todos los personajes
        window.gameCharacters = [];

        // --- shelly_data.js ---
        window.gameCharacters.push({
            name: 'Shelly',
            img: 'avatares/shelly.png', // Ejemplo de ruta local
            dilemmas: [
                { description: '¬°Hay un enemigo solo! Puedo acercarme y acabar con √©l.', options: [{ text: '¬°Ataca de cerca!', narrative: '¬°BUM! Acabas con √©l, pero te llevas un golpe.', effects: { ataque: 15, superpoder: 15, vida: -10 } }, { text: '¬°A cubierto!', narrative: 'Te pones a cubierto. M√°s seguro, pero pierdes la oportunidad.', effects: { defensa: 15 } }] },
                { description: '¬°Mi S√∫per est√° listo! Puedo romperles la cobertura.', options: [{ text: '¬°Usa el S√∫per!', narrative: '¬°El S√∫per arrasa con todo! Los enemigos est√°n al descubierto.', effects: { ataque: 25, superpoder: -100 } }, { text: 'Gu√°rdalo', narrative: 'Decides esperar. Te preparas para defender.', effects: { defensa: 10 } }] }
            ]
        });

        // --- poco_data.js ---
        window.gameCharacters.push({
            name: 'Poco',
            img: 'avatares/poco.png',
            dilemmas: [
                { description: '¬°El equipo necesita curaci√≥n! Puedo tocar mi guitarra para sanarnos.', options: [{ text: '¬°Toca para curar!', narrative: 'La m√∫sica de Poco cura al equipo. ¬°Qu√© alivio!', effects: { vida: 25, ataque: -5 } }, { text: '¬°Sigue atacando!', narrative: 'Decides que atacar es lo mejor. ¬°No hay descanso!', effects: { ataque: 10, superpoder: 10 } }] },
                { description: 'Puedo tocar una canci√≥n que sube la moral. ¬°Atacaremos con m√°s ganas!', options: [{ text: '¬°Dale ritmo!', narrative: '¬°La m√∫sica es pegadiza! El equipo ataca con m√°s fuerza.', effects: { ataque: 15, superpoder: 15, defensa: -5 } }, { text: 'Mejor silencio', narrative: 'Pides concentraci√≥n. El equipo se prepara para defender.', effects: { defensa: 15 } }] }
            ]
        });

        // --- el_primo_data.js ---
        window.gameCharacters.push({
            name: 'El Primo',
            img: 'avatares/el_primo.png',
            dilemmas: [
                { description: '¬°Hay muchos enemigos juntos! ¬°Es el momento de mi salto!', options: [{ text: '¬°SALTA!', narrative: '¬°EL PRIMOOO! Cae sobre ellos. Recibes da√±o pero cargas mucho S√∫per.', effects: { vida: -20, ataque: 10, superpoder: 30 } }, { text: 'Espera y defiende', narrative: 'Aseguras la posici√≥n. Aburrido, pero seguro.', effects: { defensa: 15 } }] },
                { description: '¬°Ese robot grande parece fuerte! ¬°Quiero pegarle!', options: [{ text: '¬°A por √©l!', narrative: 'Te lanzas contra el robot. Es una pelea dura que te deja herido.', effects: { vida: -25, superpoder: 25 } }, { text: 'Mejor desde lejos', narrative: 'Le dispar√°is desde una distancia segura.', effects: { ataque: 10 } }] }
            ]
        });
    </script>


    <!-- =================================================================== -->
    <!-- === MOTOR DEL JUEGO (La L√≥gica Principal) === -->
    <!-- =================================================================== -->
    <script>
        // --- ESTADO DEL JUEGO ---
        let stats = { vida: 80, ataque: 20, defensa: 20, superpoder: 0 };
        let currentAssault = 1;
        let gameOver = false;
        let isSuperResolution = false; 

        // --- CARGA DE DATOS ---
        const characters = window.gameCharacters;

        // --- ELEMENTOS DEL DOM ---
        const ui = {
            assaultCounter: document.getElementById('assault-counter'),
            healthBar: document.getElementById('health-bar'), healthText: document.getElementById('health-text'),
            attackBar: document.getElementById('attack-bar'), attackText: document.getElementById('attack-text'),
            defenseBar: document.getElementById('defense-bar'), defenseText: document.getElementById('defense-text'),
            superBar: document.getElementById('super-bar'), superText: document.getElementById('super-text'),
            charImg: document.getElementById('char-img'), charName: document.getElementById('char-name'),
            dilemmaDescription: document.getElementById('dilemma-description'),
            choice1: document.getElementById('choice-1'), choice2: document.getElementById('choice-2'),
            superButton: document.getElementById('super-button'),
            gameOverlay: document.getElementById('game-overlay'), overlayTitle: document.getElementById('overlay-title'), overlayText: document.getElementById('overlay-text'), overlayButton: document.getElementById('overlay-button'),
            resolutionOverlay: document.getElementById('resolution-overlay'), resolutionTitle: document.getElementById('resolution-title'), resolutionNarrative: document.getElementById('resolution-narrative'), resolutionEffects: document.getElementById('resolution-effects'), resolutionContinue: document.getElementById('resolution-continue'),
        };

        // --- L√ìGICA DEL JUEGO ---
        
        function initGame() {
            stats = { vida: 80, ataque: 20, defensa: 20, superpoder: 0 };
            currentAssault = 1;
            gameOver = false;
            
            ui.gameOverlay.classList.add('hidden-overlay');
            ui.superButton.onclick = useSuper;
            ui.resolutionContinue.onclick = handleContinueClick;
            nextAssault();
        }

        function updateUI() {
            ui.assaultCounter.textContent = currentAssault;
            ui.healthBar.style.width = `${stats.vida}%`; ui.healthText.textContent = `${stats.vida}%`;
            ui.attackBar.style.width = `${stats.ataque}%`; ui.attackText.textContent = `${stats.ataque}%`;
            ui.defenseBar.style.width = `${stats.defensa}%`; ui.defenseText.textContent = `${stats.defensa}%`;
            ui.superBar.style.width = `${stats.superpoder}%`; ui.superText.textContent = `${stats.superpoder}%`;

            ui.superButton.disabled = stats.superpoder < 100;
        }

        function nextAssault() {
            if (gameOver) return;

            const char = characters[Math.floor(Math.random() * characters.length)];
            const dilemma = char.dilemmas[Math.floor(Math.random() * char.dilemmas.length)];

            ui.charName.textContent = char.name;
            ui.charImg.src = char.img;
            // Fallback por si la imagen local no carga
            ui.charImg.onerror = () => { ui.charImg.src = `https://placehold.co/800x800/cccccc/ffffff?text=${char.name.substring(0,2)}`; };

            ui.dilemmaDescription.textContent = dilemma.description;
            
            ui.choice1.textContent = dilemma.options[0].text;
            ui.choice2.textContent = dilemma.options[1].text;
            
            ui.choice1.onclick = () => chooseOption(dilemma.options[0], char.name);
            ui.choice2.onclick = () => chooseOption(dilemma.options[1], char.name);

            updateUI();
        }

        function chooseOption(action, charName) {
            if (gameOver) return;
            
            let combinedEffects = { ...action.effects };
            let narrative = action.narrative;

            const baseDamage = 5 + currentAssault;
            const finalDamage = Math.max(1, baseDamage - Math.floor(stats.defensa / 5));
            combinedEffects.vida = (combinedEffects.vida || 0) - finalDamage;
            narrative += ` Los enemigos contraatacan.`;

            isSuperResolution = false; 
            showResolution(charName, narrative, combinedEffects);
        }
        
        function useSuper() {
            if (stats.superpoder < 100) return;
            
            const superEffects = {
                superpoder: -100,
                vida: 33,
                ataque: 33,
                defensa: 34
            };
            
            isSuperResolution = true;
            showResolution('¬°SUPERPODER!', '¬°Un impulso de poder refuerza todas tus capacidades por igual!', superEffects);
        }

        function showResolution(title, narrative, effects) {
            let effectDescriptions = [];
            for (const key in effects) {
                if (effects[key] === 0) continue;
                const value = effects[key];
                stats[key] = Math.round(stats[key] + value);
                stats[key] = Math.max(0, Math.min(100, stats[key]));
                
                const icon = {vida: '‚ù§Ô∏è', ataque: 'üí•', defensa: 'üõ°Ô∏è', superpoder: 'üåü'}[key];
                const name = {vida: 'Vida', ataque: 'Ataque', defensa: 'Defensa', superpoder: 'Superpoder'}[key];
                const change = value > 0 ? `+${value}%` : `${value}%`;
                const color = value > 0 ? 'text-green-400' : 'text-red-400';
                effectDescriptions.push(`<p class="${color}">${icon} ${name}: ${change}</p>`);
            }
            
            ui.resolutionTitle.textContent = title;
            ui.resolutionNarrative.textContent = narrative;
            ui.resolutionEffects.innerHTML = effectDescriptions.join('');
            ui.resolutionOverlay.classList.remove('hidden-overlay');
        }

        function handleContinueClick() {
            ui.resolutionOverlay.classList.add('hidden-overlay');
            
            if (!isSuperResolution) {
                currentAssault++;
            }

            updateUI();
            checkGameOver();
            if (!gameOver) {
                nextAssault();
            }
        }

        function checkGameOver() {
            if (stats.vida <= 0) {
                showEndScreen();
            }
        }

        function showEndScreen() {
            gameOver = true;
            ui.gameOverlay.classList.remove('hidden-overlay');
            ui.overlayTitle.textContent = "¬°DERROTADO!";
            ui.overlayText.textContent = `¬°Has aguantado ${currentAssault} asaltos! Int√©ntalo de nuevo para superar tu r√©cord.`;
            ui.overlayButton.textContent = 'Volver a Empezar';
        }

        // --- INICIO DEL JUEGO ---
        ui.overlayTitle.textContent = 'Brawl Reigns: Batalla Infinita';
        ui.overlayText.textContent = '¬°Comanda a tu escuadr√≥n! Aguanta el m√°ximo n√∫mero de asaltos posible. ¬°Cada turno la batalla ser√° m√°s dif√≠cil!';
        ui.overlayButton.textContent = '¬°A la Batalla!';
        ui.overlayButton.onclick = initGame;

    </script>
</body>
</html>
