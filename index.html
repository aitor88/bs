<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brawl Stars: Batalla Modular</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #1a202c;
        }
        .font-title {
            font-family: 'Lilita One', cursive;
        }
        .stat-bar-inner {
            transition: width 0.5s ease-in-out;
        }
        .game-container {
            max-width: 500px;
            width: 100%;
            height: 100vh;
            max-height: 900px;
            display: flex;
            flex-direction: column;
        }
        .choice-button {
            transition: background-color 0.2s, transform 0.2s;
            border-bottom-width: 4px;
            min-height: 70px; /* Asegura altura m√≠nima */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
        }
        .choice-button:hover {
            transform: translateY(-2px);
        }
        .choice-button:active {
            transform: translateY(1px);
        }
        #super-button:disabled {
            filter: grayscale(80%);
            cursor: not-allowed;
        }
        #game-overlay, #resolution-overlay, #notification {
            transition: opacity 0.5s;
        }
        .hidden-overlay {
            opacity: 0;
            pointer-events: none;
        }
        #player-name-input {
            background-color: #2d3748;
            border: 2px solid #4a5568;
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem;
            text-align: center;
            font-size: 1.25rem;
        }
        #ranking-list li {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem;
            border-bottom: 1px solid #4a5568;
        }
        #ranking-list li:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center min-h-screen p-2 sm:p-4">

    <div id="game-container" class="game-container bg-gray-800 rounded-3xl shadow-2xl p-3 sm:p-6 flex flex-col justify-between relative overflow-hidden">
        
        <!-- Secci√≥n de Estad√≠sticas -->
        <div id="stats-container" class="space-y-1.5">
            <div class="flex justify-between items-center text-yellow-300 font-title text-base">
                <div>
                    <span>Jugador: </span>
                    <span id="player-name-display"></span>
                </div>
                <div>
                    <span>ASALTO </span>
                    <span id="assault-counter">1</span>
                </div>
            </div>
            <!-- Vida -->
            <div class="stat">
                <div class="flex justify-between items-center"><span class="text-sm font-bold text-green-400">‚ù§Ô∏è VIDA</span><span id="health-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2"><div id="health-bar" class="bg-green-500 h-2 rounded-full stat-bar-inner"></div></div>
            </div>
            <!-- Ataque -->
            <div class="stat">
                <div class="flex justify-between items-center"><span class="text-sm font-bold text-orange-400">üí• ATAQUE</span><span id="attack-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2"><div id="attack-bar" class="bg-orange-500 h-2 rounded-full stat-bar-inner"></div></div>
            </div>
            <!-- Defensa -->
            <div class="stat">
                <div class="flex justify-between items-center"><span class="text-sm font-bold text-sky-400">üõ°Ô∏è DEFENSA</span><span id="defense-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2"><div id="defense-bar" class="bg-sky-500 h-2 rounded-full stat-bar-inner"></div></div>
            </div>
            <!-- Superpoder -->
            <div class="stat">
                <div class="flex justify-between items-center"><span class="text-sm font-bold text-yellow-400">üåü SUPERPODER</span><span id="super-text" class="text-sm font-bold"></span></div>
                <div class="w-full bg-gray-700 rounded-full h-2"><div id="super-bar" class="bg-yellow-400 h-2 rounded-full stat-bar-inner"></div></div>
            </div>
        </div>

        <!-- Secci√≥n de Carta del Dilema -->
        <div class="flex-grow flex flex-col items-center justify-center my-2 sm:my-4 relative">
            <div id="dilemma-card" class="bg-gray-700 rounded-2xl shadow-xl p-4 w-full max-w-sm text-center flex flex-col items-center justify-center flex-grow">
                <img id="char-img" src="" class="w-28 h-28 sm:w-36 sm:h-36 rounded-full object-cover mb-2 border-4 border-gray-600" alt="Personaje">
                <h2 id="char-name" class="font-title text-2xl sm:text-3xl text-yellow-300 mb-1"></h2>
                <p id="dilemma-description" class="text-gray-200 text-base sm:text-lg"></p>
            </div>
        </div>
        
        <!-- Bot√≥n de Superpoder -->
        <div class="my-2">
            <button id="super-button" class="choice-button w-full bg-yellow-500 border-yellow-700 hover:bg-yellow-400 text-gray-900 font-bold py-2 px-4 rounded-xl text-lg sm:text-xl font-title">
                USAR SUPERPODER
            </button>
        </div>

        <!-- Secci√≥n de Decisiones -->
        <div id="choices-section" class="grid grid-cols-2 gap-2 sm:gap-3">
            <button id="choice-1" class="choice-button bg-red-600 border-red-800 hover:bg-red-500 text-white font-bold rounded-xl text-sm sm:text-base"></button>
            <button id="choice-2" class="choice-button bg-blue-600 border-blue-800 hover:bg-blue-500 text-white font-bold rounded-xl text-sm sm:text-base"></button>
        </div>

        <!-- Overlay de Resoluci√≥n -->
        <div id="resolution-overlay" class="hidden-overlay absolute inset-0 bg-black bg-opacity-90 flex flex-col items-center justify-center text-center p-6 rounded-3xl z-30">
            <h1 id="resolution-title" class="font-title text-3xl sm:text-4xl mb-3 text-yellow-300"></h1>
            <p id="resolution-narrative" class="text-base sm:text-lg mb-4"></p>
            <div id="resolution-effects" class="text-left space-y-1 mb-6 text-base"></div>
            <button id="resolution-continue" class="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-full text-lg sm:text-xl font-title">Continuar</button>
        </div>

        <!-- Overlay de Inicio/Fin -->
        <div id="game-overlay" class="absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center text-center p-6 rounded-3xl z-20">
            <h1 id="overlay-title" class="font-title text-4xl sm:text-6xl mb-4 text-yellow-300"></h1>
            
            <!-- Pantalla de Inicio -->
            <div id="start-screen">
                <input type="text" id="player-name-input" placeholder="Escribe tu nombre" class="w-full mb-4 font-title">
                <p id="overlay-text" class="text-lg sm:text-xl mb-8"></p>
                <button id="overlay-button" class="bg-green-500 hover:bg-green-400 text-white font-bold py-3 px-8 rounded-full text-xl sm:text-2xl font-title"></button>
            </div>

            <!-- Pantalla de Fin -->
            <div id="end-screen" class="hidden w-full">
                 <p id="end-score-text" class="text-xl mb-4"></p>
                 <div id="ranking-container" class="w-full max-w-md bg-gray-700 rounded-lg p-4 mb-6">
                    <h2 class="font-title text-2xl text-yellow-300 mb-2">üèÜ Ranking üèÜ</h2>
                    <ul id="ranking-list" class="text-lg"></ul>
                 </div>
                 <button id="restart-button" class="bg-green-500 hover:bg-green-400 text-white font-bold py-3 px-8 rounded-full text-xl sm:text-2xl font-title"></button>
            </div>
        </div>

        <!-- Notificaci√≥n de Superpoder -->
        <div id="notification" class="hidden-overlay absolute bottom-24 left-1/2 -translate-x-1/2 bg-red-600 text-white font-bold py-2 px-5 rounded-lg shadow-lg pointer-events-none font-title">
            ¬°No tienes superpoder suficiente!
        </div>
    </div>

    <!-- =================================================================== -->
    <!-- === CARGA DE DATOS DESDE ARCHIVOS EXTERNOS === -->
    <!-- =================================================================== -->
    <script>
        // Este array se llenar√° con los datos de los archivos .js
        window.gameCharacters = [];
    </script>
    <script src="datos/shelly_data.js"></script>
    <script src="datos/poco_data.js"></script>
    <script src="datos/el_primo_data.js"></script>
    <script src="datos/leon_data.js"></script>
    <!-- Si a√±ades m√°s personajes, a√±ade una l√≠nea <script> aqu√≠ para su archivo -->


    <!-- =================================================================== -->
    <!-- === MOTOR DEL JUEGO (La L√≥gica Principal) === -->
    <!-- =================================================================== -->
    <script>
        // --- ESTADO DEL JUEGO ---
        let stats = { vida: 80, ataque: 20, defensa: 20, superpoder: 0 };
        let currentAssault = 1;
        let gameOver = false;
        let isSuperResolution = false; 
        let playerName = '';

        // --- CARGA DE DATOS ---
        const characters = window.gameCharacters;

        // --- ELEMENTOS DEL DOM ---
        const ui = {
            assaultCounter: document.getElementById('assault-counter'),
            playerNameDisplay: document.getElementById('player-name-display'),
            healthBar: document.getElementById('health-bar'), healthText: document.getElementById('health-text'),
            attackBar: document.getElementById('attack-bar'), attackText: document.getElementById('attack-text'),
            defenseBar: document.getElementById('defense-bar'), defenseText: document.getElementById('defense-text'),
            superBar: document.getElementById('super-bar'), superText: document.getElementById('super-text'),
            charImg: document.getElementById('char-img'), charName: document.getElementById('char-name'),
            dilemmaDescription: document.getElementById('dilemma-description'),
            choice1: document.getElementById('choice-1'), choice2: document.getElementById('choice-2'),
            superButton: document.getElementById('super-button'),
            notification: document.getElementById('notification'), 
            gameOverlay: document.getElementById('game-overlay'), overlayTitle: document.getElementById('overlay-title'),
            startScreen: document.getElementById('start-screen'), overlayText: document.getElementById('overlay-text'), overlayButton: document.getElementById('overlay-button'),
            playerNameInput: document.getElementById('player-name-input'),
            endScreen: document.getElementById('end-screen'), endScoreText: document.getElementById('end-score-text'),
            rankingContainer: document.getElementById('ranking-container'), rankingList: document.getElementById('ranking-list'),
            restartButton: document.getElementById('restart-button'),
            resolutionOverlay: document.getElementById('resolution-overlay'), resolutionTitle: document.getElementById('resolution-title'), resolutionNarrative: document.getElementById('resolution-narrative'), resolutionEffects: document.getElementById('resolution-effects'), resolutionContinue: document.getElementById('resolution-continue'),
        };

        // --- L√ìGICA DEL JUEGO ---
        
        function initGame() {
            playerName = ui.playerNameInput.value.trim() || 'Brawler';
            stats = { vida: 80, ataque: 20, defensa: 20, superpoder: 0 };
            currentAssault = 1;
            gameOver = false;
            
            ui.gameOverlay.classList.add('hidden-overlay');
            nextAssault();
        }

        function updateUI() {
            ui.assaultCounter.textContent = currentAssault;
            ui.playerNameDisplay.textContent = playerName;
            ui.healthBar.style.width = `${stats.vida}%`; ui.healthText.textContent = `${stats.vida}%`;
            ui.attackBar.style.width = `${stats.ataque}%`; ui.attackText.textContent = `${stats.ataque}%`;
            ui.defenseBar.style.width = `${stats.defensa}%`; ui.defenseText.textContent = `${stats.defensa}%`;
            ui.superBar.style.width = `${stats.superpoder}%`; ui.superText.textContent = `${stats.superpoder}%`;

            ui.superButton.disabled = stats.superpoder < 100;
        }

        function nextAssault() {
            if (gameOver) return;

            const char = characters[Math.floor(Math.random() * characters.length)];
            const dilemma = char.dilemmas[Math.floor(Math.random() * char.dilemmas.length)];

            ui.charName.textContent = char.name;
            ui.charImg.src = char.img;
            ui.charImg.onerror = () => { ui.charImg.src = `https://placehold.co/150x150/cccccc/ffffff?text=${char.name.substring(0,2)}`; };

            ui.dilemmaDescription.textContent = dilemma.description;
            
            ui.choice1.textContent = dilemma.options[0].text;
            ui.choice2.textContent = dilemma.options[1].text;
            
            ui.choice1.onclick = () => chooseOption(dilemma.options[0], char.name);
            ui.choice2.onclick = () => chooseOption(dilemma.options[1], char.name);

            updateUI();
        }

        function chooseOption(action, charName) {
            if (gameOver) return;
            
            let combinedEffects = { ...action.effects };
            let narrative = action.narrative;

            const baseDamage = 3 + (currentAssault * 2); 
            const finalDamage = Math.max(1, baseDamage - Math.floor(stats.defensa / 5));
            combinedEffects.vida = (combinedEffects.vida || 0) - finalDamage;
            narrative += ` Los enemigos contraatacan.`;

            isSuperResolution = false; 
            showResolution(charName, narrative, combinedEffects);
        }
        
        function useSuper() {
            if (stats.superpoder < 100) {
                ui.notification.classList.remove('hidden-overlay');
                setTimeout(() => {
                    ui.notification.classList.add('hidden-overlay');
                }, 2000);
                return;
            }
            
            const superEffects = {
                superpoder: -100,
                vida: 33,
                ataque: 33,
                defensa: 34
            };
            
            isSuperResolution = true;
            showResolution('¬°SUPERPODER!', '¬°Un impulso de poder refuerza todas tus capacidades por igual!', superEffects);
        }

        function showResolution(title, narrative, effects) {
            let effectDescriptions = [];
            for (const key in effects) {
                if (effects[key] === 0) continue;
                const value = effects[key];
                stats[key] = Math.round(stats[key] + value);
                stats[key] = Math.max(0, Math.min(100, stats[key]));
                
                const icon = {vida: '‚ù§Ô∏è', ataque: 'üí•', defensa: 'üõ°Ô∏è', superpoder: 'üåü'}[key];
                const name = {vida: 'Vida', ataque: 'Ataque', defensa: 'Defensa', superpoder: 'Superpoder'}[key];
                const change = value > 0 ? `+${value}%` : `${value}%`;
                const color = value > 0 ? 'text-green-400' : 'text-red-400';
                effectDescriptions.push(`<p class="${color}">${icon} ${name}: ${change}</p>`);
            }
            
            ui.resolutionTitle.textContent = title;
            ui.resolutionNarrative.textContent = narrative;
            ui.resolutionEffects.innerHTML = effectDescriptions.join('');
            ui.resolutionOverlay.classList.remove('hidden-overlay');
        }

        function handleContinueClick() {
            ui.resolutionOverlay.classList.add('hidden-overlay');
            
            if (!isSuperResolution) {
                currentAssault++;
            }

            updateUI();
            checkGameOver();
            if (!gameOver) {
                nextAssault();
            }
        }

        function checkGameOver() {
            if (stats.vida <= 0) {
                showEndScreen();
            }
        }

        function saveScore(name, score) {
            const ranking = JSON.parse(localStorage.getItem('brawlStarsRanking')) || [];
            ranking.push({ name, score });
            ranking.sort((a, b) => b.score - a.score);
            const topScores = ranking.slice(0, 5); // Guardar solo el top 5
            localStorage.setItem('brawlStarsRanking', JSON.stringify(topScores));
        }

        function displayRanking() {
            const ranking = JSON.parse(localStorage.getItem('brawlStarsRanking')) || [];
            ui.rankingList.innerHTML = '';
            if (ranking.length === 0) {
                ui.rankingList.innerHTML = '<li>¬°S√© el primero en jugar!</li>';
                return;
            }
            ranking.forEach(entry => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${entry.name}</span><span>${entry.score} Asaltos</span>`;
                ui.rankingList.appendChild(li);
            });
        }

        function showEndScreen() {
            gameOver = true;
            saveScore(playerName, currentAssault);
            
            ui.startScreen.classList.add('hidden');
            ui.endScreen.classList.remove('hidden');
            
            ui.overlayTitle.textContent = "¬°DERROTADO!";
            ui.endScoreText.textContent = `¬°Has aguantado ${currentAssault} asaltos!`;
            displayRanking();

            ui.gameOverlay.classList.remove('hidden-overlay');
        }

        function setupStartScreen() {
            ui.endScreen.classList.add('hidden');
            ui.startScreen.classList.remove('hidden');
            ui.overlayTitle.textContent = 'Brawl Stars: Batalla Infinita';
            ui.overlayText.textContent = '¬°Comanda a tu escuadr√≥n! Aguanta el m√°ximo n√∫mero de asaltos posible.';
            ui.overlayButton.textContent = '¬°A la Batalla!';
            ui.restartButton.textContent = 'Volver a Empezar';
            ui.overlayButton.onclick = initGame;
            ui.restartButton.onclick = setupStartScreen;
        }

        // --- INICIO DEL JUEGO ---
        ui.superButton.onclick = useSuper;
        ui.resolutionContinue.onclick = handleContinueClick;
        setupStartScreen();

    </script>
</body>
</html>
